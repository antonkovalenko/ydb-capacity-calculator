<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capacity Calculator</title>
    <link rel="icon" href="https://storage.yandexcloud.net/ydb-site-assets/ydb_icon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="css/ydb-tech.css">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <header>
        <h1>
            <img src="https://storage.yandexcloud.net/ydb-site-assets/ydb_icon.svg" alt="YDB Logo" class="logo">
            YDB Capacity Calculator
        </h1>
        <p>Calculate the number of servers required for your YDB cluster</p>
    </header>

    <main>
        <!-- Calculation Mode Toggle -->
        <div class="story-toggle" role="tablist" aria-label="Calculation Modes">
            <button id="servers-needed-toggle" class="toggle-button active" role="tab">How many servers I need for requested resources?</button>
            <button id="resources-provided-toggle" class="toggle-button" role="tab">How many resources I get from a number of servers?</button>
        </div>

        <form id="calculator-form">
            <!-- Server Configuration Section -->
            <section class="form-section">
                <div class="section-header">
                    <h2>Server Configuration <a href="#" id="view-settings-link" class="settings-link" title="View resource reservation settings">View resource reservation settings</a></h2>
                    <button type="button" id="toggle-server-config" class="toggle-button">Hide</button>
                </div>

                <div id="server-config-content">
                    <div class="subsection">
                    <h3>Compute</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="cores-per-server">Cores per server <span class="required">*</span></label>
                            <input type="number" id="cores-per-server" min="1" step="1" placeholder="e.g. 32" required aria-required="true">
                        </div>
                        <div class="form-group">
                            <label for="ram-per-server">RAM per server (GB) <span class="required">*</span></label>
                            <input type="number" id="ram-per-server" min="1" step="1" placeholder="e.g. 1024" required aria-required="true">
                        </div>
                    </div>
                </div>

                <div class="subsection">
                    <h3>Storage</h3>
                    <div class="storage-grid">
                        <div class="form-group">
                            <label for="nvme-devices-per-server">NVMe devices per server:</label>
                            <input type="number" id="nvme-devices-per-server" min="0" max="16" step="1" value="0" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label for="nvme-device-size">NVMe device size (TB):</label>
                            <input type="number" id="nvme-device-size" min="0" step="0.1" value="0" placeholder="e.g. 1">
                        </div>
                        <div class="form-group">
                            <label for="vdisks-per-nvme-pdisk">VDisks per NVMe PDisk:</label>
                            <input type="number" id="vdisks-per-nvme-pdisk" min="1" max="32" step="1" value="16" title="Typical default 16">
                        </div>

                        <div class="form-group">
                            <label for="hdd-devices-per-server">HDD devices per server:</label>
                            <input type="number" id="hdd-devices-per-server" min="0" max="16" step="1" value="0" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label for="hdd-device-size">HDD device size (TB):</label>
                            <input type="number" id="hdd-device-size" min="0" step="0.1" value="0" placeholder="e.g. 4">
                        </div>
                        <div class="form-group">
                            <label for="vdisks-per-hdd-pdisk">VDisks per HDD PDisk:</label>
                            <input type="number" id="vdisks-per-hdd-pdisk" min="1" max="16" step="1" value="8" title="Typical default 8">
                        </div>
                    </div>
                </div>
                
                <!-- Reserved Resources Display (per server) -->
                <div class="subsection" id="reserved-resources-display" style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 4px; border-left: 4px solid #007bff;">
                    <h3 style="margin-top: 0; color: #007bff;">Resource Overhead (per server)</h3>
                    <div class="results-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                        <div class="result-item" style="padding: 8px 0;">
                            <span class="result-label" style="font-size: 0.9em;">System Reserved Cores:</span>
                            <span class="result-value" id="overhead-system-cores" style="font-weight: bold;">-</span>
                        </div>
                        <div class="result-item" style="padding: 8px 0;">
                            <span class="result-label" style="font-size: 0.9em;">Storage Reserved Cores:</span>
                            <span class="result-value" id="overhead-storage-cores" style="font-weight: bold;">-</span>
                        </div>
                        <div class="result-item" style="padding: 8px 0;">
                            <span class="result-label" style="font-size: 0.9em;">System Reserved RAM (GB):</span>
                            <span class="result-value" id="overhead-system-ram" style="font-weight: bold;">-</span>
                        </div>
                        <div class="result-item" style="padding: 8px 0;">
                            <span class="result-label" style="font-size: 0.9em;">Storage Reserved RAM (GB):</span>
                            <span class="result-value" id="overhead-storage-ram" style="font-weight: bold;">-</span>
                        </div>
                        <div class="result-item" style="padding: 8px 0; grid-column: 1 / -1; border-top: 1px solid #dee2e6; margin-top: 8px; padding-top: 12px;">
                            <span class="result-label" style="font-size: 0.95em; color: #28a745;">Available for Database:</span>
                            <span class="result-value" id="overhead-available" style="font-weight: bold; color: #28a745;">-</span>
                        </div>
                    </div>
                </div>
                </div>

                <div id="server-config-summary" class="server-summary hidden" aria-live="polite"></div>
            </section>

            <!-- Servers Needed Mode: Capacity Requirements Section -->
            <section class="form-section" id="servers-needed-section">
                <h2>Capacity Requirements</h2>

                <div class="subsection">
                    <h3>Storage Requirements</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="nvme-storage-groups">NVMe Storage Groups:</label>
                            <input type="number" id="nvme-storage-groups" min="0" step="1" value="0" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label for="hdd-storage-groups">HDD Storage Groups:</label>
                            <input type="number" id="hdd-storage-groups" min="0" step="1" value="0" placeholder="0">
                        </div>
                    </div>
                </div>

                <div class="subsection">
                    <h3>Compute Requirements</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="database-cores">Database Node Cores:</label>
                            <input type="number" id="database-cores" min="0" step="1" value="0" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label for="database-ram">Database Node RAM (GB):</label>
                            <input type="number" id="database-ram" min="0" step="1" value="0" placeholder="0">
                        </div>
                    </div>
                </div>
            </section>

            <!-- Resources Provided Mode: Server Count Section -->
            <section class="form-section hidden" id="resources-provided-section">
                <h2>Server Count</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="server-count">Number of Servers: <span class="required">*</span></label>
                        <input type="number" id="server-count" min="9" step="1" placeholder="e.g. 12">
                        <div class="helper-text">
                            <strong>Minimum requirement:</strong> Mirror-3dc configuration requires at least <strong>9 servers</strong> to work.
                            <br>
                            <em>Recommended:</em> 12 servers for production use.
                        </div>
                    </div>
                </div>
            </section>

            <div style="text-align:center; margin-top:10px;">
                <button type="submit" id="calculate-button" class="calculate-button">Calculate</button>
            </div>
        </form>

        <!-- Servers Needed Mode Results -->
        <section id="servers-needed-results" class="hidden" aria-live="polite">
            <h2>Calculation Results — Capacity Planner</h2>
            <div class="results-grid">
                <div id="storage-servers-item" class="result-item">
                    <span class="result-label">Servers required by storage groups:</span>
                    <span class="result-value" id="storage-servers-result"></span>
                </div>
                <div id="cores-servers-item" class="result-item">
                    <span class="result-label">Servers required by cores:</span>
                    <span class="result-value" id="cores-servers-result"></span>
                </div>
                <div id="ram-servers-item" class="result-item">
                    <span class="result-label">Servers required by RAM:</span>
                    <span class="result-value" id="ram-servers-result"></span>
                </div>
                <div id="dominant-item" class="result-item">
                    <span class="result-label">Dominant resource:</span>
                    <span class="result-value" id="dominant-resource-result"></span>
                </div>
                <div id="final-item" class="result-item">
                    <span class="result-label">Final server count:</span>
                    <span class="result-value" id="final-servers-result"></span>
                </div>
            </div>
        </section>

        <!-- Resources Provided Mode Results -->
        <section id="resources-provided-results" class="hidden" aria-live="polite">
            <h2>Calculation Results — Provided Capacity</h2>
            <div class="results-section">
                <h3>Storage Capacity:</h3>
                <div class="results-grid">
                    <div class="result-item">
                        <span class="result-label">NVMe Storage Groups:</span>
                        <span class="result-value" id="nvme-storage-groups-result"></span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">HDD Storage Groups:</span>
                        <span class="result-value" id="hdd-storage-groups-result"></span>
                    </div>
                </div>
            </div>
            <div class="results-section">
                <h3>Database Capacity:</h3>
                <div class="results-grid">
                    <div class="result-item">
                        <span class="result-label">Database Cores:</span>
                        <span class="result-value" id="database-cores-result"></span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Database RAM (GB):</span>
                        <span class="result-value" id="database-ram-result"></span>
                    </div>
                </div>
            </div>
            
            <!-- Reserved Resources Feature: Breakdown -->
            <div class="results-section">
                <h3>Reserved Resources (per server):</h3>
                <div class="results-grid">
                    <div class="result-item">
                        <span class="result-label">System Reserved Cores:</span>
                        <span class="result-value" id="system-cores-reserved-result"></span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Storage Reserved Cores:</span>
                        <span class="result-value" id="storage-cores-reserved-result"></span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">System Reserved RAM (GB):</span>
                        <span class="result-value" id="system-ram-reserved-result"></span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Storage Reserved RAM (GB):</span>
                        <span class="result-value" id="storage-ram-reserved-result"></span>
                    </div>
                </div>
            </div>
            
            <div class="results-section">
                <h3>Available Resources (per server):</h3>
                <div class="results-grid">
                    <div class="result-item">
                        <span class="result-label">Available Cores for Database:</span>
                        <span class="result-value" id="available-cores-result"></span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Available RAM for Database (GB):</span>
                        <span class="result-value" id="available-ram-result"></span>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>YDB Capacity Calculator &copy; <span id="copyright-year"></span></p>
    </footer>

    <!-- Warning popover (shown when user enters not-recommended values) -->
    <div id="warning-popover-overlay" class="hidden" role="dialog" aria-modal="true" aria-labelledby="warning-popover-title">
        <div id="warning-popover">
            <button id="warning-popover-close" class="toggle-button" aria-label="Close warning">Close</button>
            <h3 id="warning-popover-title">Configuration warning</h3>
            <div id="warning-popover-messages"></div>
            <div style="text-align:center; margin-top:12px;">
                <img id="warning-popover-image" src="images/cthulhu.png" alt="Warning illustration" style="max-width:100%; width:640px; height:auto;">
            </div>
        </div>
    </div>

    <!-- Resource Reservation Settings Modal -->
    <div id="settings-modal-overlay" class="hidden" role="dialog" aria-modal="true" aria-labelledby="settings-modal-title">
        <div id="settings-modal">
            <button id="settings-modal-close" class="modal-close-button" aria-label="Close settings">×</button>
            <h3 id="settings-modal-title">Resource Reservation Settings</h3>
            <p class="modal-description">These settings are used to calculate resource overhead and available capacity.</p>
            
            <div class="settings-section">
                <h4>System Resources (per server)</h4>
                <div class="settings-grid">
                    <div class="setting-item">
                        <span class="setting-label">CPU Cores Reserved:</span>
                        <span class="setting-value">2 cores</span>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">RAM Reserved:</span>
                        <span class="setting-value">4 GB</span>
                    </div>
                </div>
            </div>
            
            <div class="settings-section">
                <h4>NVMe Storage Resources (per device)</h4>
                <div class="settings-grid">
                    <div class="setting-item">
                        <span class="setting-label">CPU Cores Reserved:</span>
                        <span class="setting-value">6 cores</span>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">RAM Reserved:</span>
                        <span class="setting-value">6 GB</span>
                    </div>
                </div>
            </div>
            
            <div class="settings-section">
                <h4>HDD Storage Resources (per device)</h4>
                <div class="settings-grid">
                    <div class="setting-item">
                        <span class="setting-label">CPU Cores Reserved:</span>
                        <span class="setting-value">0.5 cores</span>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">RAM Reserved:</span>
                        <span class="setting-value">2 GB</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/core.js"></script>
    <script src="js/calculator.js"></script>
</body>
</html>